---
title: 'AWS re:Invent 2025 - Automating Suricata rules for AWS network firewall (DEV206)'
published: true
description: 'In this video, the presenter shares an automated pipeline for managing AWS Network Firewall Suricata rules. The session covers why Network Firewall was chosen, its architecture in north-south inspection deployment, and the challenges of manually writing Suricata rules where syntax precision is critical. The solution uses CSV files as input, Lambda functions for rule generation and validation, versioned S3 buckets for rollback capability, and EventBridge for monitoring. Key features include wildcard subdomain matching, automatic CIDR translation, and rule ordering enforcement. This automation transforms Suricata rule management from an expert-only process into a self-service, repeatable workflow that enables teams to manage hundreds of rules safely and efficiently.'
tags: ''
cover_image: 'https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/0.jpg'
series: ''
canonical_url: null
id: 3093309
date: '2025-12-08T22:27:03Z'
---

**ðŸ¦„ Making great presentations more accessible.**
This project enhances multilingual accessibility and discoverability while preserving the original content. Detailed transcriptions and keyframes capture the nuances and technical insights that convey the full value of each session.

**Note**: A comprehensive list of re:Invent 2025 transcribed articles is available in this [Spreadsheet](https://docs.google.com/spreadsheets/d/13fihyGeDoSuheATs_lSmcluvnX3tnffdsh16NX0M2iA/edit?usp=sharing)!

# Overview


ðŸ“– **AWS re:Invent 2025 - Automating Suricata rules for AWS network firewall (DEV206)**

> In this video, the presenter shares an automated pipeline for managing AWS Network Firewall Suricata rules. The session covers why Network Firewall was chosen, its architecture in north-south inspection deployment, and the challenges of manually writing Suricata rules where syntax precision is critical. The solution uses CSV files as input, Lambda functions for rule generation and validation, versioned S3 buckets for rollback capability, and EventBridge for monitoring. Key features include wildcard subdomain matching, automatic CIDR translation, and rule ordering enforcement. This automation transforms Suricata rule management from an expert-only process into a self-service, repeatable workflow that enables teams to manage hundreds of rules safely and efficiently.

{% youtube https://www.youtube.com/watch?v=XnrAXZd9sRc %}
; This article is entirely auto-generated while preserving the original presentation content as much as possible. Please note that there may be typos or inaccuracies.

# Main Part
[![Thumbnail 0](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/0.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=0)

### Understanding AWS Network Firewall and the Challenge of Suricata Rules

 Hi everyone, and welcome to DEV206, Automating Suricata Rules for AWS Network Firewall. I'm excited to share with you all my experience building an automated pipeline for developing and populating network firewall rules, why this was built, the architecture, and the benefits we gained. But real quick, before we get into the real content, show of hands: how many of you are familiar with network firewall or any other kind of firewall device? All right, that's great to see. Keep them up if you have any responsibility for configuring these firewall devices. Awesome. And last question: how many of you have any experience or have ever had to deal with actually writing the Suricata rules that go in network firewall?

[![Thumbnail 80](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/80.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=80)

Awesome, glad to see we have a great mix of experience here in the room. For those of you who think maybe I just made up a word, Suricata, not to worry. In the next 20 minutes, you will become well versed in the ins and outs of network firewall and Suricata rules. So for those of you who had your hand raised at the last question, you might be able to relate a bit to  this cat here, terrified about the thought of having to update your Suricata rule set and do the even more difficult task of ensuring these rules actually do what you intend. At the end of this session, I hope you're walking away with some tools and some inspiration you can use to make this process easier.

[![Thumbnail 110](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/110.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=110)

[![Thumbnail 130](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/130.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=130)

 Today we'll start with a quick background on AWS Network Firewall, then we'll look at firewall rules and Suricata, the rules engine behind these network firewall rules. Then we'll dive into the design of the automation solution and finish with the benefits of implementing this solution. Before we dive into the solution, I wanted to talk really quick: why network firewall when there are so many  firewall options out there? Our end goal was to add firewalls to our AWS cloud environment to provide greater flexibility and control around which connections were allowed to egress from our cloud environment, and we were looking at various options in order to help us achieve that.

[![Thumbnail 180](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/180.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=180)

[![Thumbnail 190](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/190.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=190)

AWS's managed firewall service, Network Firewall, integrates directly with AWS services, making it a breeze to manage and operate. Additionally, its pricing model, which is composed of running hours and traffic processed, was very convenient when we were looking at ephemeral workloads. Some quick bits about AWS Network Firewall: like I said, it offers many AWS integrations,  both CloudWatch and S3 for logging, and also AWS Firewall Manager and Security Hub for centralized governance and management.  Additionally, today we'll be talking about rules at layer 7, but Network Firewall does support defining rules on layers 3 through 7 and includes functionalities for deep packet inspection and domain filtering.

[![Thumbnail 210](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/210.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=210)

[![Thumbnail 230](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/230.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=230)

 Like other AWS networking services, AWS Network Firewall has great scalability options and can scale up to 100 gigabits per second per availability zone, and that gives you a lot of free range in terms of how much traffic this one firewall device can support. And lastly, Network Firewall can be deployed in a  few deployment options: north-south, which is used to inspect traffic that goes between your cloud environment and the public internet, as well as east-west to inspect traffic that goes between two portions of your cloud environment.

[![Thumbnail 250](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/250.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=250)

[![Thumbnail 270](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/270.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=270)

 Today, this is a sample architecture we will be looking at. In our environment, Network Firewall is deployed in that north-south inspection architecture, which means that Network Firewall inspects traffic which originates in our cloud environments. In this case, some sample workload VPCs are bound for the public internet  and pass through the Network Firewall deployed in centralized inspection VPCs, where we can configure centralized controls and enable traffic segmentation. So that's where our rules live within our cloud environment.

[![Thumbnail 300](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/300.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=300)

Now let's take a quick look at what are all these components that make up these network firewall rules. So each Network Firewall device has a firewall policy, and this firewall policy contains  two broad categories of rule groups: stateful and stateless. Stateless rule groups do not take into consideration the direction of traffic or the related packets in the same flow.

Therefore, the rules that are implemented in stateless rule groups are a lot coarser. Today we'll be looking at stateful rule groups where the direction of traffic and those related packets come into play.

[![Thumbnail 330](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/330.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=330)

Within stateful rule groups, there are two kinds.  You have AWS managed rule groups, and these are rules that are provided on your behalf by AWS. They're ready to use and come preconfigured, so they combine thorough security coverage with the convenience and expertise of those AWS managed solutions. However, they are not specific to your environment, your industry, or your business needs. Therefore, to best leverage the full power of AWS Network Firewall, it's also recommended that you include customer managed rules that can handle those bespoke requirements.

[![Thumbnail 370](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/370.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=370)

[![Thumbnail 380](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/380.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=380)

Within customer  managed rules, we have three kinds. The first are stateful standard rules. These are rules that are defined via the UI, API, or CloudFormation,  and you provide the inputs and AWS transforms those inputs into the underlying rules. Similarly, with domain list rules, you provide the lists of domains or subdomains that you wish to allow or deny traffic to, as well as HTTP or HTTPS traffic, and again, AWS handles the logic for you. So these rules are both really convenient, but it's important to know that AWS is in control of that conversion logic that transforms your inputs into those destination rules.

[![Thumbnail 430](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/430.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=430)

[![Thumbnail 440](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/440.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=440)

In order to leverage the full flexibility and power of the underlying Suricata IPS system, it's also recommended to incorporate Suricata compatible rule strings into your environment.  These are rules where you are directly providing those Suricata rules to the underlying firewall device. When we're looking at all of this in a  holistic view, there are a few things I recommend. First, it's a great starting point to use the AWS managed rule groups. They're easy to set up and they give you a great baseline level of security controls, but be aware of the costs if you choose to implement active threat defense types of rules. But as we shared earlier, if you really want to get the full power out of Network Firewall, let's look at Suricata compatible rule strings as well.

[![Thumbnail 470](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/470.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=470)

[![Thumbnail 490](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/490.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=490)

[![Thumbnail 500](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/500.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=500)

### The Problem with Manual Suricata Rule Management and an Automated Solution

 However, once you start looking at Suricata compatible rule strings, you are in the driver's seat. You are responsible for providing that Suricata rule syntax. A single line of the Suricata syntax can define a full traffic decision, specifying both the source, the destination,  and any additional filters based on the type of rule you're configuring. However, it's important to note the syntax  matters, and even a small mistake can completely change your firewall's behavior.

[![Thumbnail 510](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/510.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=510)

[![Thumbnail 530](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/530.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=530)

Let's take some examples. First, we have a rule which is  supposed to drop traffic that is bound to the second level domain evil.com. However, how it's written, it would actually also match traffic bound to other domains such as weevil.com, nottheevil.com, etc. A very similar rule, but a little bit different.  We have a rule that includes a period and a dotprefix modifier, and this rule would match traffic that is bound to all subdomains of evil.com, but not evil.com without any subdomain.

[![Thumbnail 550](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/550.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=550)

[![Thumbnail 570](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/570.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=570)

The same need for specificity also is present when we're looking at rule ordering.  This first pair of rules has the alert rule before the drop rule, so you'll be getting logs about which traffic is going to be dropped before the dropping actually occurs. But if you accidentally switch the ordering of those rules, the drop rule will take place before the alert rule even has a chance to  fire, so you've now lost all visibility into what traffic was actually dropped.

[![Thumbnail 600](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/600.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=600)

These may seem like minor changes, but they demonstrate why precision and repeatability are critical. While the Suricata rules are incredibly powerful, it's become clear that managing them manually creates a major bottleneck. Suricata rules, based on the nature of understanding the syntax, often depend  on reliance on a few Suricata experts who are comfortable both with that Suricata syntax and the internal requirements around your rules.

[![Thumbnail 610](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/610.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=610)

[![Thumbnail 630](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/630.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=630)

[![Thumbnail 640](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/640.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=640)

 On top of that, AWS Network Firewall's implementation is a subset of the features provided by generic Suricata. So that means not every rule you might already have or find on the internet is going to be compatible with Network Firewall. And as we saw earlier,  the syntax is very specific, and so even small syntax mistakes can lead to many iterations of having to change and revise your Suricata rules.  The result leads to difficulty in maintaining your rule set and makes it difficult to leverage the full capabilities of AWS Network Firewall, leaving the organization's security posture less than optimal.

This is why we've chosen automation to transform Suricata rule generation from an expert-only process into something that is repeatable, testable, scalable, and empowers the entire team to contribute confidently. So what did we do about all these problems? Let's take a quick look at a before and after of the lifecycle of a Suricata rule. Every rule begins with the raw requirements, the IPs, the domains, the business outcome that you want your rule to achieve. Previously, an engineer, a Suricata expert, had to manually go and author that rule directly.

[![Thumbnail 700](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/700.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=700)

[![Thumbnail 720](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/720.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=720)

[![Thumbnail 740](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/740.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=740)

This has been replaced with an automated Lambda function  that automatically generates the correct syntax, the right ordering, the right modifiers that can ensure that these rules are consistent across the board. Additionally, Network Firewall doesn't have a native versioning system, so if you realize you made a bad change  to your Suricata rule set and you needed to roll back, well, you better hope you had a local copy saved somewhere or were really good at searching Slack or email because Suricata couldn't roll back for you. With our new solution, this has been replaced with a versioned S3 bucket, so all inputs and outputs are  saved and makes it easy to roll back in case of failure.

[![Thumbnail 760](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/760.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=760)

Lastly, Suricata sometimes would error when you were trying to upload the rules directly to Network Firewall, and this has been replaced with a second Lambda that automatically validates and catches any errors in uploading  these rules to the Network Firewall device. So without further ado, let's get into it. What is the pipeline and what did we do about all these problems? Here's an overview. The process starts with a user, and the user uploads a CSV file to a Git repository, which then pushes these input files to a versioned S3 bucket.

[![Thumbnail 800](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/800.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=800)

[![Thumbnail 810](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/810.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=810)

Upon these files landing in S3, the rule generation Lambda is invoked, which creates that Suricata syntax. This output is then populated back into the same S3 bucket, which again invokes a second Lambda  which pushes these rules into the Network Firewall device. Overall, we have EventBridge and CloudWatch Logs monitoring the whole solution.  Essentially, this pipeline blends the ease of use of AWS managed solutions with the precision and flexibility of utilizing custom Suricata rules. The result is faster iteration, fewer errors, and a more consistent and transparent approach to managing your firewall rules.

[![Thumbnail 830](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/830.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=830)

### How the Automated Pipeline Works: From CSV Input to Validated Firewall Rules

 So the first step is capturing these rules in a simple structured format. In our case, we chose CSV files. Each row represents one logical statement specifying protocol, ports, the desired action, domains, and so on. This approach makes it easy for anyone on the team to propose changes without worrying about that specialized syntax. Once a CSV is uploaded, the Lambda transforms these into properly formatted Suricata rules.

[![Thumbnail 860](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/860.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=860)

[![Thumbnail 900](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/900.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=900)

 The Lambda handles enforcing the correct Suricata keywords like alert, drop, and so on, translating your VPC IDs into their CIDR blocks, which is a requirement within the Suricata rules. It enforces clean messaging if logging is enabled and ensures that that logging rule is created before the underlying action rule. In this simple example, you can see that it's easy to understand where the benefit of this solution comes from. But let's take a more complex example. This solution includes two  wildcard functionalities for subdomain matching.

We have two asterisk wildcard options. The double asterisk wildcard matches both traffic to that second level domain and all of its subdomains, while the single asterisk matches traffic to all subdomains but not the second level domain itself. With these wildcards, we can create more complex sets of rules.

[![Thumbnail 930](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/930.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=930)

In this example,  the system will first generate a rule that matches the first protocol, TLS, and the second level domain evil.com, corresponding to all those VPC CIDRs. Additionally, it creates a very similar rule for HTTP traffic, and then it will create the TLS rule for matching all of those subdomains for alsoevil.com. And again, the HTTP comparable rule as well.

[![Thumbnail 960](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/960.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=960)

[![Thumbnail 990](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/990.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=990)

 After generating the firewall rules, a second layer of validation Lambda is applied to check the Suricata rules for any malformed entries or any other syntax-related issues. It also evaluates the compiled length of the rules and checks it against the length of the rule group configured in the Network Firewall device. Additionally, it automatically reports any errors back to engineers,  shortening the troubleshooting cycle and allowing them to fix the problems before the deployments continue.

[![Thumbnail 1000](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/1000.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=1000)

 If you would like to explore building a similar workflow, the QR code here has some sample code for that first Lambda, the Lambda which takes those raw inputs and generates the Suricata rule string for you. But there are a few things I want you to remember. Suricata is powerful, but precision matters. Automation reduces the risk that syntax mistakes can cause or rule ordering issues may arise. Additionally, your rule intent becomes the source of truth. Engineers describe what should happen, and the pipeline defines the Suricata syntax to make that a reality.

Event-driven automation improves safety. Validation, versioning, and error handling are all built in. AWS native services keep the solution lightweight. We utilize S3, Lambda, EventBridge, and CloudWatch Logs to enable a fully serverless workflow. And lastly, faster and safer rule updates. Teams can respond quickly to threats without needing that Suricata specialization.

The result is a self-service, safe, and repeatable process for managing these Suricata rules. Engineers focus on the intent, and the pipeline handles the rest. This enables full leverage of AWS Network Firewall capabilities, reduces operational overhead, and builds confidence that our firewall rules are both current and correct.

[![Thumbnail 1090](https://raw.githubusercontent.com/kazuya-iwami/devto-repo/main/posts/images/afb2d7ec7f5d4576/1090.jpg)](https://www.youtube.com/watch?v=XnrAXZd9sRc&t=1090)

This workflow doesn't just speed up rule  creation, it makes large rule groups easy to manage even when we're dealing with hundreds or thousands of rules within a single rule group. The automation handles the ordering, the validation, and consistency for us. The result is that scaling our firewall protections no longer increases the operational burden. We can update and deploy large complex rules in minutes.

Thank you everyone for joining me this afternoon. If you would like to talk more about the solution or more about Network Firewall in general, I will be over against that black curtain after the session ends, and I would love to answer any questions on your behalf. I would appreciate if you would fill out your session survey in the mobile app. And with that, I hope everyone has a great rest of your afternoon and enjoy the rest of re:Invent. Thank you.


----

; This article is entirely auto-generated using Amazon Bedrock.
